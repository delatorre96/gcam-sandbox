lines(veg_output_ref$year, veg_output_ref$value, col = 'yellow', lwd = 2)
legend('bottomright', legend = c('Vegetables newScen', 'Tomatoes newScen', 'Vegetables refScen'),
col = c('blue', 'red', 'yellow'), lty = 1, lwd = 2)
View(demandByCrop)
names(demandByCrop)
demandByCrop[demandByCrop['input'] == 'Vegetables']
demandByCrop[demandByCrop['input'] == 'Vegetables',]
demandByCrop[demandByCrop['sector'] == 'Vegetables',]
demandByCrop[demandByCrop['sector'] == 'regional vegetables',]
demandByCrop[demandByCrop['input'] == 'regional vegetables',]
demandByCrop[demandByCrop['input'] == 'regional tomatoes',]
demandByCrop[demandByCrop['input'] == 'regional Tomatoes',]
View(land_allocation)
names(land_allocation)
############# land allocation by crop #############
land_allocation <- getQuery(prj1, "land allocation by crop")
region ='USA'
### Vegetables land_allocation before and after ###
land_allocation_region <- land_allocation[(land_allocation['region'] == region) &
(land_allocation['landleaf'] == 'Vegetables'),]
scen_ref <- land_allocation_region[land_allocation_region['scenario'] == 'Reference', ]
scen_tom <- land_allocation_region[land_allocation_region['scenario'] == 'crop_tomatoes', ]
plot(scen_ref$year,scen_ref$value, type = 'l', col = 'blue', lwd = 2,
main = 'Vegetables production under scenarios',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prodByCrop_region$value),max(ag_prodByCrop_region$value)))
lines(scen_tom$year, scen_tom$value, col = 'red', lwd = 2)
legend('bottomright', legend = c('reference', 'disaggregatedCrop'),
col = c('blue', 'red'), lty = 1, lwd = 2)
### Vegetables land_allocation before and after ###
land_allocation_region <- land_allocation[(land_allocation['region'] == region) &
(land_allocation['landleaf'] == 'Vegetables'),]
scen_ref <- land_allocation_region[land_allocation_region['scenario'] == 'Reference', ]
scen_tom <- land_allocation_region[land_allocation_region['scenario'] == 'crop_tomatoes', ]
plot(scen_ref$year,scen_ref$value, type = 'l', col = 'blue', lwd = 2,
main = 'Vegetables production under scenarios',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(land_allocation_region$value),max(land_allocation_region$value)))
lines(scen_tom$year, scen_tom$value, col = 'red', lwd = 2)
legend('bottomright', legend = c('reference', 'disaggregatedCrop'),
col = c('blue', 'red'), lty = 1, lwd = 2)
### Tomatoes and Vegetables in same scenario ###
### Vegetables land_allocation before and after ###
land_allocation_region <- land_allocation[(land_allocation['region'] == region) &
(land_allocation['landleaf'] == 'Vegetables'),]
scen_ref <- land_allocation_region[land_allocation_region['scenario'] == 'Reference', ]
scen_tom <- land_allocation_region[land_allocation_region['scenario'] == 'crop_tomatoes', ]
plot(scen_ref$year,scen_ref$value, type = 'l', col = 'blue', lwd = 2,
main = 'Vegetables production under scenarios',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(land_allocation_region$value),max(land_allocation_region$value)))
lines(scen_tom$year, scen_tom$value, col = 'red', lwd = 2)
legend('topright', legend = c('reference', 'disaggregatedCrop'),
col = c('blue', 'red'), lty = 1, lwd = 2)
land_allocation_region <- land_allocation[
land_allocation$region == region  &
land_allocation$output %in% c("Vegetables", "Tomatoes"), ]
land_allocation_region <- land_allocation[
land_allocation$region == region  &
land_allocation$landleaf %in% c("Vegetables", "Tomatoes"), ]
veg_output_newCrop <- land_allocation_region[(land_allocation_region['landleaf'] == 'Vegetables') & (land_allocation_region['scenario'] == "crop_tomatoes"), ]
tom_output_newCrop <- land_allocation_region[(land_allocation_region['landleaf'] == 'Tomatoes') & (land_allocation_region['scenario']  == "crop_tomatoes"), ]
veg_output_ref <- land_allocation_region[(land_allocation_region['landleaf'] == 'Vegetables') & (land_allocation_region['scenario'] == "Reference"), ]
plot(veg_output$year,veg_output$value, type = 'l', col = 'blue', lwd = 2,
main = 'landleaf Veg and Tom',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prodByCrop_region$value) -10,max(ag_prodByCrop_region$value)))
lines(tom_output$year, tom_output$value, col = 'red', lwd = 2)
lines(veg_output_ref$year, veg_output_ref$value, col = 'yellow', lwd = 2)
legend('bottomright', legend = c('Vegetables newScen', 'Tomatoes newScen', 'Vegetables refScen'),
col = c('blue', 'red', 'yellow'), lty = 1, lwd = 2)
land_allocation_region <- land_allocation[
land_allocation$region == region  &
land_allocation$landleaf %in% c("Vegetables", "Tomatoes"), ]
veg_landleaf_newCrop <- land_allocation_region[(land_allocation_region['landleaf'] == 'Vegetables') & (land_allocation_region['scenario'] == "crop_tomatoes"), ]
tom_landleaf_newCrop <- land_allocation_region[(land_allocation_region['landleaf'] == 'Tomatoes') & (land_allocation_region['scenario']  == "crop_tomatoes"), ]
veg_landleaf_ref <- land_allocation_region[(land_allocation_region['landleaf'] == 'Vegetables') & (land_allocation_region['scenario'] == "Reference"), ]
plot(veg_landleaf_newCrop$year,veg_landleaf_newCrop$value, type = 'l', col = 'blue', lwd = 2,
main = 'landleaf Veg and Tom',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prodByCrop_region$value) -10,max(ag_prodByCrop_region$value)))
lines(tom_landleaf_newCrop$year, tom_landleaf_newCrop$value, col = 'red', lwd = 2)
lines(veg_landleaf_ref$year, veg_landleaf_ref$value, col = 'yellow', lwd = 2)
legend('bottomright', legend = c('Vegetables newScen', 'Tomatoes newScen', 'Vegetables refScen'),
col = c('blue', 'red', 'yellow'), lty = 1, lwd = 2)
land_allocation_region <- land_allocation[
land_allocation$region == region  &
land_allocation$landleaf %in% c("Vegetables", "Tomatoes"), ]
veg_landleaf_newCrop <- land_allocation_region[(land_allocation_region['landleaf'] == 'Vegetables') & (land_allocation_region['scenario'] == "crop_tomatoes"), ]
tom_landleaf_newCrop <- land_allocation_region[(land_allocation_region['landleaf'] == 'Tomatoes') & (land_allocation_region['scenario']  == "crop_tomatoes"), ]
veg_landleaf_ref <- land_allocation_region[(land_allocation_region['landleaf'] == 'Vegetables') & (land_allocation_region['scenario'] == "Reference"), ]
plot(veg_landleaf_newCrop$year,veg_landleaf_newCrop$value, type = 'l', col = 'blue', lwd = 2,
main = 'landleaf Veg and Tom',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(land_allocation_region$value) -10,max(land_allocation_region$value)))
lines(tom_landleaf_newCrop$year, tom_landleaf_newCrop$value, col = 'red', lwd = 2)
lines(veg_landleaf_ref$year, veg_landleaf_ref$value, col = 'yellow', lwd = 2)
legend('bottomright', legend = c('Vegetables newScen', 'Tomatoes newScen', 'Vegetables refScen'),
col = c('blue', 'red', 'yellow'), lty = 1, lwd = 2)
View(hist_land_allocation)
View(agg_hist_land_allocation)
############# Production by crop #############
ag_prodByCrop <- getQuery(prj1, "ag production by crop type")
region ='USA'
### Vegetables production before and after ###
ag_prodByCrop_region <- ag_prodByCrop[(ag_prodByCrop['region'] == region) &
(ag_prodByCrop['output'] == 'Vegetables'),]
scen_ref <- ag_prodByCrop_region[ag_prodByCrop_region['scenario'] == 'Reference', ]
scen_tom <- ag_prodByCrop_region[ag_prodByCrop_region['scenario'] == 'crop_tomatoes', ]
plot(scen_ref$year,scen_ref$value, type = 'l', col = 'blue', lwd = 2,
main = 'Vegetables production under scenarios',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prodByCrop_region$value),max(ag_prodByCrop_region$value)))
lines(scen_tom$year, scen_tom$value, col = 'red', lwd = 2)
legend('bottomright', legend = c('reference', 'disaggregatedCrop'),
col = c('blue', 'red'), lty = 1, lwd = 2)
### Tomatoes and Vegetables in same scenario ###
ag_prodByCrop_region <- ag_prodByCrop[
ag_prodByCrop$region == region  &
ag_prodByCrop$output %in% c("Vegetables", "Tomatoes"), ]
veg_output_newCrop <- ag_prodByCrop_region[(ag_prodByCrop_region['output'] == 'Vegetables') & (ag_prodByCrop_region['scenario'] == "crop_tomatoes"), ]
tom_output_newCrop <- ag_prodByCrop_region[(ag_prodByCrop_region['output'] == 'Tomatoes') & (ag_prodByCrop_region['scenario']  == "crop_tomatoes"), ]
veg_output_ref <- ag_prodByCrop_region[(ag_prodByCrop_region['output'] == 'Vegetables') & (ag_prodByCrop_region['scenario'] == "Reference"), ]
plot(veg_output$year,veg_output$value, type = 'l', col = 'blue', lwd = 2,
main = 'Production Veg and Tom',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prodByCrop_region$value) -10,max(ag_prodByCrop_region$value)))
lines(tom_output$year, tom_output$value, col = 'red', lwd = 2)
lines(veg_output_ref$year, veg_output_ref$value, col = 'yellow', lwd = 2)
legend('bottomright', legend = c('Vegetables newScen', 'Tomatoes newScen', 'Vegetables refScen'),
col = c('blue', 'red', 'yellow'), lty = 1, lwd = 2)
ag_prodByCrop <- getQuery(prj1, "ag production by crop type")
region ='USA'
### Vegetables production before and after ###
ag_prodByCrop_region <- ag_prodByCrop[(ag_prodByCrop['region'] == region) &
(ag_prodByCrop['output'] == 'Vegetables'),]
scen_ref <- ag_prodByCrop_region[ag_prodByCrop_region['scenario'] == 'Reference', ]
scen_tom <- ag_prodByCrop_region[ag_prodByCrop_region['scenario'] == 'crop_tomatoes', ]
plot(scen_ref$year,scen_ref$value, type = 'l', col = 'blue', lwd = 2,
main = 'Vegetables production under scenarios',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prodByCrop_region$value),max(ag_prodByCrop_region$value)))
lines(scen_tom$year, scen_tom$value, col = 'red', lwd = 2)
legend('bottomright', legend = c('reference', 'disaggregatedCrop'),
col = c('blue', 'red'), lty = 1, lwd = 2)
ag_prodByCrop_region <- ag_prodByCrop[
ag_prodByCrop$region == region  &
ag_prodByCrop$output %in% c("Vegetables", "Tomatoes"), ]
veg_output_newCrop <- ag_prodByCrop_region[(ag_prodByCrop_region['output'] == 'Vegetables') & (ag_prodByCrop_region['scenario'] == "crop_tomatoes"), ]
tom_output_newCrop <- ag_prodByCrop_region[(ag_prodByCrop_region['output'] == 'Tomatoes') & (ag_prodByCrop_region['scenario']  == "crop_tomatoes"), ]
veg_output_ref <- ag_prodByCrop_region[(ag_prodByCrop_region['output'] == 'Vegetables') & (ag_prodByCrop_region['scenario'] == "Reference"), ]
plot(veg_output$year,veg_output$value, type = 'l', col = 'blue', lwd = 2,
main = 'Production Veg and Tom',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prodByCrop_region$value) -10,max(ag_prodByCrop_region$value)))
lines(tom_output$year, tom_output$value, col = 'red', lwd = 2)
lines(veg_output_ref$year, veg_output_ref$value, col = 'yellow', lwd = 2)
legend('bottomright', legend = c('Vegetables newScen', 'Tomatoes newScen', 'Vegetables refScen'),
col = c('blue', 'red', 'yellow'), lty = 1, lwd = 2)
View(ag_prodByCrop)
str(ag_prodByCrop)
unique(ag_prodByCrop['Region'])
unique(ag_prodByCrop['region'])
print(unique(ag_prodByCrop['region']), n = 22)
print(unique(ag_prodByCrop['region']), n = 220)
View(ag_prodByCrop)
pathToDbs <- "C:/Users/ignacio.delatorre/Documents/GCAM/gcam-core/output"
my_gcamdb_basexdb <- "crop"
conn <- localDBConn(pathToDbs, my_gcamdb_basexdb)
myQueryfile  <- "C:/Users/ignacio.delatorre/Documents/GCAM/rgcam/myQueries_crop.xml"
scenariosAnalyze<-c( "Reference","crop_tomatoes")
prj1 <- addScenario(conn = conn, proj = 'C:/Users/ignacio.delatorre/Documents/GCAM/desarrollos/crop/myProject.dat', scenario  = scenariosAnalyze, queryFile = myQueryfile)
queries <- listQueries(prj1)
print(queries)
ag_prod_byTech <- getQuery(prj1,  "ag production by tech" )
View(ag_prod_byTech)
unique(ag_prod_byTech['technology'])
print(queries)
agProd_landUse  <- getQuery(prj1,  "ag production in a specified land use region" )
View(agProd_landUse)
pathToDbs <- "C:/Users/ignacio.delatorre/Documents/GCAM/gcam-core/output"
my_gcamdb_basexdb <- "crop"
conn <- localDBConn(pathToDbs, my_gcamdb_basexdb)
myQueryfile  <- "C:/Users/ignacio.delatorre/Documents/GCAM/rgcam/myQueries_crop.xml"
scenariosAnalyze<-c( "Reference","crop_tomatoes")
prj1 <- addScenario(conn = conn, proj = 'C:/Users/ignacio.delatorre/Documents/GCAM/desarrollos/crop/myProject.dat', scenario  = scenariosAnalyze, queryFile = myQueryfile)
queries <- listQueries(prj1)
print(queries)
aaa <- getQuery(prj1,  "Water Withdrawals by Basin (Runoff)" )
View(aaa)
ag_prod_byTech_basin = ag_prod_byTech[ag_prod_byTech$technology == basin, ]
basin = 'biomassGrass_EbroR_IRR_hi'
ag_prod_byTech_basin = ag_prod_byTech[ag_prod_byTech$technology == basin, ]
View(ag_prod_byTech_basin)
View(ag_prod_byTech)
basin = 'Vegetables_EbroR_IRR_hi'
ag_prod_byTech_basin = ag_prod_byTech[ag_prod_byTech$technology == basin, ]
View(ag_prod_byTech_basin)
ag_prod_byTech_basin = ag_prod_byTech[ag_prod_byTech$technology %in% basin, ]
basin = 'Ebro'
ag_prod_byTech_basin = ag_prod_byTech[ag_prod_byTech$technology %in% basin, ]
View(ag_prod_byTech_basin)
ag_prod_byTech_basin = ag_prod_byTech[basin %in% ag_prod_byTech$technology, ]
ag_prod_byTech_basin = ag_prod_byTech[grepl(basin, ag_prod_byTech$'techonology'), ]
basin = 'Ebro'
ag_prod_byTech_basin = ag_prod_byTech[grepl(basin, ag_prod_byTech$techonology), ]
ag_prod_byTech_basin = ag_prod_byTech[grepl(basin, ag_prod_byTech$technology), ]
ag_prod_byTech_basin <- ag_prod_byTech_basin[ ag_prod_byTech_basin$output %in% c("Vegetables", "Tomatoes"), ]
ag_prod_byTech_basin = ag_prod_byTech[(grepl(basin, ag_prod_byTech$technology)) & (ag_prod_byTech_basin$output %in% c("Vegetables", "Tomatoes"), ]
ag_prod_byTech_basin = ag_prod_byTech[(grepl(basin, ag_prod_byTech$technology)) & (ag_prod_byTech_basin$output %in% c("Vegetables", "Tomatoes")), ]
ag_prod_byTech_basin = ag_prod_byTech[(grepl(basin, ag_prod_byTech$technology)) & (ag_prod_byTech$output %in% c("Vegetables", "Tomatoes")), ]
View(ag_prod_byTech_basin)
veg_output_newCrop <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Vegetables') & (ag_prod_byTech_basin['scenario'] == "crop_tomatoes"), ]
tom_output_newCrop <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Tomatoes') & (ag_prod_byTech_basin['scenario']  == "crop_tomatoes"), ]
veg_output_ref <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Vegetables') & (ag_prod_byTech_basin['scenario'] == "Reference"), ]
plot(veg_output$year,veg_output$value, type = 'l', col = 'blue', lwd = 2,
main = 'Production Veg and Tom in Ebro basin',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prod_byTech_basin$value) -10,max(ag_prod_byTech_basin$value)))
lines(tom_output$year, tom_output$value, col = 'red', lwd = 2)
lines(veg_output_ref$year, veg_output_ref$value, col = 'yellow', lwd = 2)
legend('bottomright', legend = c('Vegetables newScen', 'Tomatoes newScen', 'Vegetables refScen'),
col = c('blue', 'red', 'yellow'), lty = 1, lwd = 2)
View(veg_output_ref)
View(veg_output_newCrop)
View(veg_output_newCrop)
View(tom_output_newCrop)
View(veg_output_ref)
unique(veg_output_ref['technology'])
unique(veg_output_ref['tom_output_newCrop'])
unique(tom_output_newCrop['technology'])
ag_prod_byTech_basin = ag_prod_byTech[(ag_prod_byTech$technology %in% c('Vegetables_EbroR_IRR_hi', 'Tomatoes_EbroR_IRR_hi')) & (ag_prod_byTech$output %in% c("Vegetables", "Tomatoes")), ]
veg_output_newCrop <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Vegetables') & (ag_prod_byTech_basin['scenario'] == "crop_tomatoes"), ]
tom_output_newCrop <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Tomatoes') & (ag_prod_byTech_basin['scenario']  == "crop_tomatoes"), ]
veg_output_ref <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Vegetables') & (ag_prod_byTech_basin['scenario'] == "Reference"), ]
plot(veg_output$year,veg_output$value, type = 'l', col = 'blue', lwd = 2,
main = 'Production Veg and Tom in Ebro basin',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prod_byTech_basin$value),max(ag_prod_byTech_basin$value)))
veg_output_ref
veg_output_newCrop <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Vegetables') & (ag_prod_byTech_basin['scenario'] == "crop_tomatoes"), ]
tom_output_newCrop <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Tomatoes') & (ag_prod_byTech_basin['scenario']  == "crop_tomatoes"), ]
veg_output_ref <- ag_prod_byTech_basin[(ag_prod_byTech_basin['output'] == 'Vegetables') & (ag_prod_byTech_basin['scenario'] == "Reference"), ]
plot(veg_output_newCrop$year,veg_output_newCrop$value, type = 'l', col = 'blue', lwd = 2,
main = 'Production Veg and Tom in Ebro basin',
xlab = 'Años',
ylab = 'Output',
ylim = c(min(ag_prod_byTech_basin$value),max(ag_prod_byTech_basin$value)))
lines(tom_output_newCrop$year, tom_output_newCrop$value, col = 'red', lwd = 2)
lines(veg_output_ref$year, veg_output_ref$value, col = 'yellow', lwd = 2)
legend('bottomright', legend = c('Vegetables newScen', 'Tomatoes newScen', 'Vegetables refScen'),
col = c('blue', 'red', 'yellow'), lty = 1, lwd = 2)
View(ag_prod_byTech)
ag_prod_byTech_eu <- ag_prod_byTech[ag_prod_byTech['region'] == 'EU-12']
ag_prod_byTech_eu <- ag_prod_byTech[ag_prod_byTech['region'] == 'EU-12',]
View(ag_prod_byTech_eu )
ag_prod_byTech_eu['subsector']
unique(ag_prod_byTech_eu['subsector'])
ag_prod_byTech_eu <- ag_prod_byTech[ag_prod_byTech['region'] == 'EU-12',]
unique(ag_prod_byTech_eu['subsector'])
View(ag_prod_byTech_eu)
View(ag_prod_byTech_eu)
print(unique(ag_prod_byTech_eu['subsector']), n = 3000)
View(ag_prod_byTech)
ag_prod_byTech_eu <- ag_prod_byTech[ag_prod_byTech['region'] == 'EU-15',]
unique(ag_prod_byTech_eu['subsector'])
print(unique(ag_prod_byTech_eu['subsector']), n = 3000)
ag_prod_byTech_eu <- ag_prod_byTech[ag_prod_byTech['region'] == 'EU-15',]
lista <- unique(ag_prod_byTech_eu['subsector'])
cuencas <- sapply(strsplit(lista, "_"), function(x) tail(x, 1))
lista
lista_subsector <- as.vector(unique(ag_prod_byTech_eu['subsector']))
lista_subsector
cuencas <- sapply(strsplit(lista, "_"), function(x) tail(x, 1))
cuencas_unicos <- unique(cuencas)
cuencas <- sapply(strsplit(lista_subsector, "_"), function(x) tail(x, 1))
lista_subsector <- as.character(unique(ag_prod_byTech_eu['subsector']))
lista_subsector
lista_subsector <- as.character(as.vector(unique(ag_prod_byTech_eu['subsector'])))
lista_subsector
lista_subsector <- as.vector(unique(ag_prod_byTech_eu['subsector']))
lista_subsector
lista_subsector <- (unique(ag_prod_byTech_eu['subsector'])
lista_subsector
lista_subsector <- unique(ag_prod_byTech_eu['subsector']
)
lista_subsector
unique(ag_prod_byTech_eu['subsector'])
unique(ag_prod_byTech_eu['subsector'])$subsector
lista_subsector <- unique(ag_prod_byTech_eu['subsector'])$subsector
cuencas <- sapply(strsplit(lista_subsector, "_"), function(x) tail(x, 1))
cuencas_unicos <- unique(cuencas)
cuencas_unicos
cuencas
cuencas_unicos
View(ag_prod_byTech_eu)
ag_prod_byTech_iberian <- ag_prod_byTech_eu[(ag_prod_byTech_eu$subsector %in% cuencas_ibericas) &
(ag_prod_byTech_eu$output == 'Tomatoes')
,]
cuencas_ibericas <- c("DouroR", "EbroR", "GuadalqR", "GuadianaR", "TagusR", "SpainCstSE", "IberiaCst")
ag_prod_byTech_iberian <- ag_prod_byTech_eu[(ag_prod_byTech_eu$subsector %in% cuencas_ibericas) &
(ag_prod_byTech_eu$output == 'Tomatoes'),]
View(ag_prod_byTech_iberian)
ag_prod_byTech_iberian <- ag_prod_byTech_eu[(ag_prod_byTech_eu$subsector %in% cuencas_ibericas) ,]
#Tomatoes por cuenca
ag_prod_byTech_iberian <- ag_prod_byTech_eu[grepl(patron, ag_prod_byTech_eu$subsector), ]
patron <- paste(cuencas_ibericas, collapse = "|")
#Tomatoes por cuenca
ag_prod_byTech_iberian <- ag_prod_byTech_eu[grepl(patron, ag_prod_byTech_eu$subsector), ]
ag_prod_byTech_iberian
View(ag_prod_byTech_iberian)
#Tomatoes por cuenca
ag_prod_byTech_iberian <- ag_prod_byTech_eu[grepl(patron, ag_prod_byTech_eu$subsector) &
(ag_prod_byTech_eu$output == 'Tomatoes'), ]
View(ag_prod_byTech_iberian)
str(ag_prod_byTech_iberian)
ag_prod_byTech_iberian <- ag_prod_byTech_iberian %>%
mutate(cuenca = sapply(subsector, function(x) {
match <- cuencas_ibericas[sapply(cuencas_ibericas, function(c) grepl(c, x))]
if(length(match) == 0) return(NA) else return(match)
}))
library(dplyr)
ag_prod_byTech_iberian <- ag_prod_byTech_iberian %>%
mutate(cuenca = sapply(subsector, function(x) {
match <- cuencas_ibericas[sapply(cuencas_ibericas, function(c) grepl(c, x))]
if(length(match) == 0) return(NA) else return(match)
}))
View(ag_prod_byTech_iberian)
str(ag_prod_byTech_iberian )
ag_prod_byTech_iberian_sum <- ag_prod_byTech_iberian %>%
group_by(cuenca, year) %>%
summarise(total_value = sum(value, na.rm = TRUE), .groups = "drop")
View(ag_prod_byTech_iberian_sum)
library(ggplot2)
for (c in cuencas_ibericas) {
df_sub <- ag_prod_byTech_iberian_sum %>% filter(cuenca == c)
p <- ggplot(df_sub, aes(x = year, y = total_value)) +
geom_line(color = "blue") +
geom_point(color = "red") +
ggtitle(paste("Producción total en cuenca:", c)) +
xlab("Año") +
ylab("Valor total") +
theme_minimal()
print(p)
}
colores <- rainbow(length(cuencas_ibericas))  # colores distintos para cada cuenca
# Establecer límites del gráfico
ylim <- range(ag_prod_byTech_iberian_sum$total_value, na.rm = TRUE)
xlim <- range(ag_prod_byTech_iberian_sum$year)
# Crear gráfico vacío
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción total por cuenca a lo largo de los años")
# Dibujar líneas para cada cuenca
for (i in seq_along(cuencas_ibericas)) {
c <- cuencas_ibericas[i]
df_sub <- ag_prod_byTech_iberian_sum[ag_prod_byTech_iberian_sum$cuenca == c, ]
lines(df_sub$year, df_sub$total_value, col = colores[i], lwd = 2)
}
# Añadir leyenda
legend("topright", legend = cuencas_ibericas, col = colores, lwd = 2, cex = 0.7)
colores <- rainbow(length(cuencas_ibericas))  # colores distintos para cada cuenca
# Establecer límites del gráfico
ylim <- range(ag_prod_byTech_iberian_sum$total_value, na.rm = TRUE)
xlim <- range(ag_prod_byTech_iberian_sum$year)
# Crear gráfico vacío
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción total por cuenca de tomates")
# Dibujar líneas para cada cuenca
for (i in seq_along(cuencas_ibericas)) {
c <- cuencas_ibericas[i]
df_sub <- ag_prod_byTech_iberian_sum[ag_prod_byTech_iberian_sum$cuenca == c, ]
lines(df_sub$year, df_sub$total_value, col = colores[i], lwd = 2)
}
# Añadir leyenda
legend("topright", legend = cuencas_ibericas, col = colores, lwd = 2, cex = 0.7)
# Crear gráfico vacío
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción total de tomates por cuenca hidrográfica")
# Dibujar líneas para cada cuenca
for (i in seq_along(cuencas_ibericas)) {
c <- cuencas_ibericas[i]
df_sub <- ag_prod_byTech_iberian_sum[ag_prod_byTech_iberian_sum$cuenca == c, ]
lines(df_sub$year, df_sub$total_value, col = colores[i], lwd = 2)
}
# Añadir leyenda
legend("topright", legend = cuencas_ibericas, col = colores, lwd = 2, cex = 0.7)
View(ag_prod_byTech_iberian)
ag_prod_byTech_iberian_duero <- ag_prod_byTech_iberian[ag_prod_byTech_iberian$cuenca == 'DouroR']
ag_prod_byTech_iberian_duero <- ag_prod_byTech_iberian[ag_prod_byTech_iberian$cuenca == 'DouroR', ]
View(ag_prod_byTech_iberian_duero)
View(ag_prod_byTech_iberian_duero)
technologies = unique(ag_prod_byTech_iberian_duero$technology)
technologies
ag_prod_byTech_iberian_duero <- ag_prod_byTech_iberian[ag_prod_byTech_iberian$cuenca == 'DouroR', ]
technologies = unique(ag_prod_byTech_iberian_duero$technology)
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción total de tomates por cuenca hidrográfica")
# Dibujar líneas para cada cuenca
for (i in seq_along(technologies)) {
c <- technologies[i]
df_sub <- ag_prod_byTech_iberian_sum[ag_prod_byTech_iberian_sum$cuenca == c, ]
lines(df_sub$year, df_sub$total_value, col = colores[i], lwd = 2)
}
legend("topright", legend = technologies, col = colores, lwd = 2, cex = 0.7)
technologies = unique(ag_prod_byTech_iberian_duero$technology)
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción total de tomates por cuenca hidrográfica")
# Dibujar líneas para cada technology
for (i in seq_along(technologies)) {
techno <- technologies[i]
df_sub <- ag_prod_byTech_iberian_duero[ag_prod_byTech_iberian_duero$technology == techno, ]
lines(df_sub$year, df_sub$total_value, col = colores[i], lwd = 2)
}
legend("topright", legend = technologies, col = colores, lwd = 2, cex = 0.7)
ag_prod_byTech_iberian_duero <- ag_prod_byTech_iberian[ag_prod_byTech_iberian$cuenca == 'DouroR', ]
technologies = unique(ag_prod_byTech_iberian_duero$technology)
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción total de tomates por cuenca hidrográfica")
# Dibujar líneas para cada technology
for (i in seq_along(technologies)) {
techno <- technologies[i]
df_sub <- ag_prod_byTech_iberian_duero[ag_prod_byTech_iberian_duero$technology == techno, ]
lines(df_sub$year, df_sub$value, col = colores[i], lwd = 2)
}
legend("topright", legend = technologies, col = colores, lwd = 2, cex = 0.7)
ag_prod_byTech_iberian_duero <- ag_prod_byTech_iberian[ag_prod_byTech_iberian$cuenca == 'DouroR', ]
technologies = unique(ag_prod_byTech_iberian_duero$technology)
plot(NA, xlab = "Año", ylab = "Valor total",
main = "Producción tomates por tecnologia en el Duero")
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción tomates por tecnologia en el Duero")
# Dibujar líneas para cada technology
for (i in seq_along(technologies)) {
techno <- technologies[i]
df_sub <- ag_prod_byTech_iberian_duero[ag_prod_byTech_iberian_duero$technology == techno, ]
lines(df_sub$year, df_sub$value, col = colores[i], lwd = 2)
}
plot(NA, xlim = xlim, ylim = 0.8, xlab = "Año", ylab = "Valor total",
main = "Producción tomates por tecnologia en el Duero")
xlim
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción tomates por tecnologia en el Duero")
# Dibujar líneas para cada technology
for (i in seq_along(technologies)) {
techno <- technologies[i]
df_sub <- ag_prod_byTech_iberian_duero[ag_prod_byTech_iberian_duero$technology == techno, ]
lines(df_sub$year, df_sub$value, col = colores[i], lwd = 2)
}
legend("topright", legend = technologies, col = colores, lwd = 2, cex = 0.7)
ylim
plot(NA, xlim = xlim, ylim = ylim[2], xlab = "Año", ylab = "Valor total",
main = "Producción tomates por tecnologia en el Duero")
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción tomates por tecnologia en el Duero")
# Dibujar líneas para cada technology
for (i in seq_along(technologies)) {
techno <- technologies[i]
df_sub <- ag_prod_byTech_iberian_duero[ag_prod_byTech_iberian_duero$technology == techno, ]
lines(df_sub$year, df_sub$value, col = colores[i], lwd = 2)
}
legend("topright", legend = technologies, col = colores, lwd = 2, cex = 0.7)
plot(NA, xlim = xlim, ylim = c(0,0.7), xlab = "Año", ylab = "Valor total",
main = "Producción tomates por tecnologia en el Duero")
# Dibujar líneas para cada technology
for (i in seq_along(technologies)) {
techno <- technologies[i]
df_sub <- ag_prod_byTech_iberian_duero[ag_prod_byTech_iberian_duero$technology == techno, ]
lines(df_sub$year, df_sub$value, col = colores[i], lwd = 2)
}
legend("topright", legend = technologies, col = colores, lwd = 2, cex = 0.7)
####### Get iberian basins
ag_prod_byTech_eu <- ag_prod_byTech[ag_prod_byTech['region'] == 'EU-15',]
lista_subsector <- unique(ag_prod_byTech_eu['subsector'])$subsector
cuencas <- sapply(strsplit(lista_subsector, "_"), function(x) tail(x, 1))
cuencas_unicos <- unique(cuencas)
cuencas_ibericas <- c("DouroR", "EbroR", "GuadalqR", "GuadianaR", "TagusR", "SpainCstSE", "IberiaCst")
patron <- paste(cuencas_ibericas, collapse = "|")
#Tomatoes por cuenca
ag_prod_byTech_iberian <- ag_prod_byTech_eu[grepl(patron, ag_prod_byTech_eu$subsector) &
(ag_prod_byTech_eu$output == 'Tomatoes'), ]
ag_prod_byTech_iberian <- ag_prod_byTech_iberian %>%
mutate(cuenca = sapply(subsector, function(x) {
match <- cuencas_ibericas[sapply(cuencas_ibericas, function(c) grepl(c, x))]
if(length(match) == 0) return(NA) else return(match)
}))
colores <- rainbow(length(cuencas_ibericas))  # colores distintos para cada cuenca
# Establecer límites del gráfico
ylim <- range(ag_prod_byTech_iberian_sum$total_value, na.rm = TRUE)
xlim <- range(ag_prod_byTech_iberian_sum$year)
# Crear gráfico vacío
plot(NA, xlim = xlim, ylim = ylim, xlab = "Año", ylab = "Valor total",
main = "Producción total de tomates por cuenca hidrográfica")
# Dibujar líneas para cada cuenca
for (i in seq_along(cuencas_ibericas)) {
c <- cuencas_ibericas[i]
df_sub <- ag_prod_byTech_iberian_sum[ag_prod_byTech_iberian_sum$cuenca == c, ]
lines(df_sub$year, df_sub$total_value, col = colores[i], lwd = 2)
}
# Añadir leyenda
legend("topright", legend = cuencas_ibericas, col = colores, lwd = 2, cex = 0.7)
